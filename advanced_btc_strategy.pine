// Advanced Bitcoin Trading Strategy
// Multi-Indicator System with Support/Resistance
// Auto-generated: 2025-11-13 13:01:54

//@version=5
strategy("Advanced BTC Multi-Indicator Strategy", 
         overlay=true, 
         initial_capital=10000,
         default_qty_type=strategy.percent_of_equity,
         default_qty_value=95,
         commission_type=strategy.commission.percent,
         commission_value=0.1,
         slippage=2)

// ============================================================================
// INPUT PARAMETERS
// ============================================================================

// Moving Averages
emaFast = input.int(12, "EMA Fast", group="Moving Averages")
emaSlow = input.int(26, "EMA Slow", group="Moving Averages")
sma50 = input.int(50, "SMA 50", group="Moving Averages")
sma200 = input.int(200, "SMA 200", group="Moving Averages")

// RSI
rsiLength = input.int(14, "RSI Length", group="RSI")
rsiOverbought = input.int(70, "Overbought Level", group="RSI")
rsiOversold = input.int(30, "Oversold Level", group="RSI")

// MACD
macdFast = input.int(12, "MACD Fast", group="MACD")
macdSlow = input.int(26, "MACD Slow", group="MACD")
macdSignal = input.int(9, "MACD Signal", group="MACD")

// Bollinger Bands
bbLength = input.int(20, "BB Length", group="Bollinger Bands")
bbStdDev = input.float(2.0, "BB Std Dev", group="Bollinger Bands")

// Stochastic
stochLength = input.int(14, "Stoch Length", group="Stochastic")
stochK = input.int(3, "Stoch %K", group="Stochastic")
stochD = input.int(3, "Stoch %D", group="Stochastic")

// ATR for Stop Loss
atrLength = input.int(14, "ATR Length", group="Risk Management")
atrMultiplier = input.float(2.0, "ATR Multiplier for SL", group="Risk Management")
riskRewardRatio = input.float(2.0, "Risk:Reward Ratio", group="Risk Management")

// Support & Resistance
srLookback = input.int(20, "S/R Lookback", group="Support & Resistance")

// Fibonacci
fibLookback = input.int(50, "Fibonacci Lookback", group="Fibonacci")

// Volume
volumeThreshold = input.float(1.5, "Volume Breakout Threshold", group="Volume")

// Date Range
startDate = input(timestamp("2020-01-01"), "Start Date", group="Date Range")
endDate = input(timestamp("2099-12-31"), "End Date", group="Date Range")
inDateRange = time >= startDate and time <= endDate

// ============================================================================
// INDICATOR CALCULATIONS
// ============================================================================

// Moving Averages
emaF = ta.ema(close, emaFast)
emaS = ta.ema(close, emaSlow)
sma_50 = ta.sma(close, sma50)
sma_200 = ta.sma(close, sma200)

// RSI
rsi = ta.rsi(close, rsiLength)

// MACD
[macdLine, signalLine, histogram] = ta.macd(close, macdFast, macdSlow, macdSignal)

// Bollinger Bands
[bbUpper, bbBasis, bbLower] = ta.bb(close, bbLength, bbStdDev)

// Stochastic
stochValue = ta.stoch(close, high, low, stochLength)
stochK_val = ta.sma(stochValue, stochK)
stochD_val = ta.sma(stochK_val, stochD)

// ATR
atr = ta.atr(atrLength)

// Volume
volumeSMA = ta.sma(volume, 20)
volumeBreakout = volume > (volumeSMA * volumeThreshold)

// OBV (On-Balance Volume)
obv = ta.obv

// ADX (Trend Strength)
[adxValue, adxPlus, adxMinus] = ta.dmi(14, 14)

// Support & Resistance (Pivot Points)
pivotHigh = ta.pivothigh(high, srLookback, srLookback)
pivotLow = ta.pivotlow(low, srLookback, srLookback)

// Fibonacci Levels
fibHigh = ta.highest(high, fibLookback)
fibLow = ta.lowest(low, fibLookback)
fibDiff = fibHigh - fibLow
fib_236 = fibHigh - (0.236 * fibDiff)
fib_382 = fibHigh - (0.382 * fibDiff)
fib_500 = fibHigh - (0.500 * fibDiff)
fib_618 = fibHigh - (0.618 * fibDiff)

// ============================================================================
// TREND DETECTION
// ============================================================================

// Multiple timeframe trend
trendUp = emaF > emaS and close > sma_50 and sma_50 > sma_200
trendDown = emaF < emaS and close < sma_50 and sma_50 < sma_200
strongTrend = adxValue > 25

// ============================================================================
// SIGNAL LOGIC
// ============================================================================

// BUY CONDITIONS (All must be true)
buyCondition1 = ta.crossover(emaF, emaS)  // EMA crossover
buyCondition2 = rsi < rsiOverbought and rsi > rsiOversold  // RSI in range
buyCondition3 = macdLine > signalLine  // MACD bullish
buyCondition4 = close > sma_50  // Above 50 SMA
buyCondition5 = stochK_val < 80  // Stochastic not overbought
buyCondition6 = not na(pivotLow) ? close > pivotLow : true  // Above recent support
buyCondition7 = volumeBreakout  // Volume confirmation

// Combined BUY signal
buySignal = buyCondition1 and buyCondition2 and buyCondition3 and 
            buyCondition4 and buyCondition5 and inDateRange

// Strong BUY (more confirmations)
strongBuySignal = buySignal and buyCondition6 and buyCondition7 and strongTrend

// SELL CONDITIONS
sellCondition1 = ta.crossunder(emaF, emaS)  // EMA crossunder
sellCondition2 = rsi > rsiOverbought  // RSI overbought
sellCondition3 = macdLine < signalLine  // MACD bearish
sellCondition4 = close < sma_50  // Below 50 SMA
sellCondition5 = stochK_val > 80  // Stochastic overbought
sellCondition6 = not na(pivotHigh) ? close < pivotHigh : false  // Below resistance

// Combined SELL signal
sellSignal = (sellCondition1 or sellCondition2 or sellCondition3) and inDateRange

// ============================================================================
// RISK MANAGEMENT
// ============================================================================

// Calculate stop loss and take profit
var float stopLoss = na
var float takeProfit = na

if buySignal or strongBuySignal
    stopLoss := close - (atr * atrMultiplier)
    takeProfit := close + (atr * atrMultiplier * riskRewardRatio)

// ============================================================================
// STRATEGY EXECUTION
// ============================================================================

// Entry
if buySignal and strategy.position_size == 0
    strategy.entry("Long", strategy.long)
    label.new(bar_index, low, "BUY\n" + str.tostring(close, "#.##"), 
              color=color.new(color.green, 0), textcolor=color.white, 
              style=label.style_label_up, size=size.small)

if strongBuySignal and strategy.position_size == 0
    strategy.entry("Strong Long", strategy.long, qty_percent=100)
    label.new(bar_index, low, "STRONG BUY\n" + str.tostring(close, "#.##"), 
              color=color.new(color.lime, 0), textcolor=color.black, 
              style=label.style_label_up, size=size.normal)

// Exit
if sellSignal and strategy.position_size > 0
    strategy.close("Long")
    strategy.close("Strong Long")
    label.new(bar_index, high, "SELL\n" + str.tostring(close, "#.##"), 
              color=color.new(color.red, 0), textcolor=color.white, 
              style=label.style_label_down, size=size.small)

// Stop Loss & Take Profit
if strategy.position_size > 0
    strategy.exit("SL/TP", stop=stopLoss, limit=takeProfit)

// ============================================================================
// PLOTTING
// ============================================================================

// Moving Averages
plot(emaF, "EMA Fast", color=color.new(color.blue, 0), linewidth=2)
plot(emaS, "EMA Slow", color=color.new(color.red, 0), linewidth=2)
plot(sma_50, "SMA 50", color=color.new(color.orange, 0), linewidth=1)
plot(sma_200, "SMA 200", color=color.new(color.purple, 50), linewidth=2)

// Bollinger Bands
p1 = plot(bbUpper, "BB Upper", color=color.new(color.gray, 70))
p2 = plot(bbLower, "BB Lower", color=color.new(color.gray, 70))
fill(p1, p2, color=color.new(color.blue, 95))

// Fibonacci Levels
plot(fib_236, "Fib 23.6%", color=color.new(color.green, 80), style=plot.style_circles)
plot(fib_382, "Fib 38.2%", color=color.new(color.yellow, 80), style=plot.style_circles)
plot(fib_500, "Fib 50.0%", color=color.new(color.orange, 60), style=plot.style_cross, linewidth=2)
plot(fib_618, "Fib 61.8%", color=color.new(color.red, 80), style=plot.style_circles)

// Support & Resistance
plotshape(pivotHigh, "Resistance", shape.triangledown, location.abovebar, 
          color=color.new(color.red, 0), size=size.tiny)
plotshape(pivotLow, "Support", shape.triangleup, location.belowbar, 
          color=color.new(color.green, 0), size=size.tiny)

// Background color for trend
bgcolor(trendUp and strongTrend ? color.new(color.green, 95) : 
        trendDown and strongTrend ? color.new(color.red, 95) : na)

// Volume bars
barcolor(volumeBreakout ? color.new(color.yellow, 50) : na)

// ============================================================================
// DASHBOARD
// ============================================================================

var table dashboard = table.new(position.top_right, 2, 12, border_width=1)

if barstate.islast
    // Header
    table.cell(dashboard, 0, 0, "INDICATORS", bgcolor=color.new(color.gray, 70), text_color=color.white)
    table.cell(dashboard, 1, 0, "VALUES", bgcolor=color.new(color.gray, 70), text_color=color.white)
    
    // Price
    table.cell(dashboard, 0, 1, "Price", text_color=color.white)
    table.cell(dashboard, 1, 1, str.tostring(close, "#.##"))
    
    // Trend
    trendText = trendUp ? "ðŸŸ¢ BULLISH" : trendDown ? "ðŸ”´ BEARISH" : "âšª NEUTRAL"
    table.cell(dashboard, 0, 2, "Trend", text_color=color.white)
    table.cell(dashboard, 1, 2, trendText, 
               bgcolor=trendUp ? color.new(color.green, 70) : 
                      trendDown ? color.new(color.red, 70) : color.new(color.gray, 70))
    
    // RSI
    table.cell(dashboard, 0, 3, "RSI", text_color=color.white)
    table.cell(dashboard, 1, 3, str.tostring(rsi, "#.##"))
    
    // MACD
    table.cell(dashboard, 0, 4, "MACD", text_color=color.white)
    table.cell(dashboard, 1, 4, str.tostring(macdLine, "#.####"))
    
    // Stochastic
    table.cell(dashboard, 0, 5, "Stoch %K", text_color=color.white)
    table.cell(dashboard, 1, 5, str.tostring(stochK_val, "#.##"))
    
    // ADX
    table.cell(dashboard, 0, 6, "ADX", text_color=color.white)
    table.cell(dashboard, 1, 6, str.tostring(adxValue, "#.##"))
    
    // Volume
    volStatus = volumeBreakout ? "ðŸ”¥ HIGH" : "Normal"
    table.cell(dashboard, 0, 7, "Volume", text_color=color.white)
    table.cell(dashboard, 1, 7, volStatus)
    
    // Position
    posText = strategy.position_size > 0 ? "ðŸŸ¢ LONG" : "âšª FLAT"
    table.cell(dashboard, 0, 8, "Position", text_color=color.white)
    table.cell(dashboard, 1, 8, posText)
    
    // PnL
    table.cell(dashboard, 0, 9, "Net Profit", text_color=color.white)
    table.cell(dashboard, 1, 9, str.tostring(strategy.netprofit, "#.##"), 
               text_color=strategy.netprofit > 0 ? color.lime : color.red)
    
    // Win Rate
    winRate = strategy.wintrades > 0 ? (strategy.wintrades / strategy.closedtrades) * 100 : 0
    table.cell(dashboard, 0, 10, "Win Rate", text_color=color.white)
    table.cell(dashboard, 1, 10, str.tostring(winRate, "#.##") + "%")
    
    // Total Trades
    table.cell(dashboard, 0, 11, "Total Trades", text_color=color.white)
    table.cell(dashboard, 1, 11, str.tostring(strategy.closedtrades))

// ============================================================================
// ALERTS
// ============================================================================

alertcondition(buySignal, "Buy Signal", "BTC: Buy Signal Triggered!")
alertcondition(strongBuySignal, "Strong Buy Signal", "BTC: STRONG Buy Signal!")
alertcondition(sellSignal, "Sell Signal", "BTC: Sell Signal Triggered!")
alertcondition(volumeBreakout, "Volume Breakout", "BTC: High Volume Detected!")

// ============================================================================
// NOTES
// ============================================================================
// This strategy combines multiple indicators for robust signals:
// - EMA crossovers for trend
// - RSI for momentum
// - MACD for confirmation
// - Bollinger Bands for volatility
// - Stochastic for overbought/oversold
// - Volume for confirmation
// - Support & Resistance levels
// - Fibonacci retracements
// - ATR-based stop loss
//
// Customize parameters in the settings for your trading style!
// ============================================================================
